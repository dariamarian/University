{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/auth/index.js","webpack:///./src/auth/router.js","webpack:///./src/auth/store.js","webpack:///./src/index.js","webpack:///./src/item/index.js","webpack:///./src/item/router.js","webpack:///./src/item/store.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///./src/utils/wss.js","webpack:///external \"@koa/cors\"","webpack:///external \"http\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\"","webpack:///external \"ws\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","userStore","insert","body","token","status","err","issue","error","message","post","ctx","request","credentials","console","log","findOne","password","UserStore","constructor","filename","autoload","store","dataStore","props","app","Koa","server","http","createServer","callback","wss","WebSocket","Server","initWss","use","cors","timingLogger","exceptionHandler","bodyParser","prefix","publicApiRouter","authRouter","routes","allowedMethods","protectedApiRouter","itemRouter","listen","get","userId","state","itemStore","find","item","params","id","createItem","broadcast","type","payload","put","itemId","updatedCount","update","del","remove","ItemStore","next","start","Date","now","method","url","value","on","ws","JSON","parse","close","verify","data","clients","forEach","client","readyState","OPEN","send","stringify"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './router';","import Router from 'koa-router';\nimport userStore from './store';\nimport jwt from 'jsonwebtoken';\nimport {jwtConfig} from '../utils';\n\nexport const router = new Router();\n\nconst createToken = (user) => {\n    return jwt.sign({username: user.username, _id: user._id}, jwtConfig.secret, {expiresIn: 60 * 60 * 60});\n};\n\nconst createUser = async (user, response) => {\n    try {\n        await userStore.insert(user);\n        response.body = {token: createToken(user), _id: user._id};\n        response.status = 201; // created\n    } catch (err) {\n        response.body = {issue: [{error: err.message}]};\n        response.status = 400; // bad request\n    }\n};\n\nrouter.post('/signup', async (ctx) => await createUser(ctx.request.body, ctx.response));\n\nrouter.post('/login', async (ctx) => {\n    const credentials = ctx.request.body;\n    console.log('Alo' + credentials);\n    const response = ctx.response;\n    const user = await userStore.findOne({username: credentials.username});\n    if (user && credentials.password === user.password) {\n        response.body = {token: createToken(user), _id: user._id};\n        response.status = 201; // created\n    } else {\n        response.body = {issue: [{error: 'Invalid credentials'}]};\n        response.status = 400; // bad request\n    }\n});\n","import dataStore from 'nedb-promise';\n\nexport class UserStore {\n    constructor({filename, autoload}) {\n        this.store = dataStore({filename, autoload});\n    }\n\n    async findOne(props) {\n        return this.store.findOne(props);\n    }\n\n    async insert(user) {\n        //\n        return this.store.insert(user);\n    };\n}\n\nexport default new UserStore({filename: './db/users.json', autoload: true});","import Koa from 'koa';\r\nimport WebSocket from 'ws';\r\nimport http from 'http';\r\nimport Router from 'koa-router';\r\nimport bodyParser from \"koa-bodyparser\";\r\nimport {timingLogger, exceptionHandler, jwtConfig, initWss} from './utils';\r\nimport {router as itemRouter} from './item';\r\nimport {router as authRouter} from './auth';\r\nimport jwt from 'koa-jwt';\r\nimport cors from '@koa/cors';\r\n\r\nconst app = new Koa();\r\nconst server = http.createServer(app.callback());\r\nconst wss = new WebSocket.Server({server});\r\ninitWss(wss);\r\n\r\napp.use(cors());\r\napp.use(timingLogger);\r\napp.use(exceptionHandler);\r\napp.use(bodyParser());\r\n\r\nconst prefix = '/api';\r\n\r\n// public\r\nconst publicApiRouter = new Router({prefix});\r\npublicApiRouter\r\n    .use('/auth', authRouter.routes());\r\napp\r\n    .use(publicApiRouter.routes())\r\n    .use(publicApiRouter.allowedMethods());\r\n\r\napp.use(jwt(jwtConfig));\r\n\r\n// protected\r\nconst protectedApiRouter = new Router({prefix});\r\nprotectedApiRouter\r\n    .use('/items', itemRouter.routes());\r\napp\r\n    .use(protectedApiRouter.routes())\r\n    .use(protectedApiRouter.allowedMethods());\r\n\r\nserver.listen(3000);\r\nconsole.log('started on port 3000');\r\n","export * from './router';","import Router from 'koa-router';\nimport itemStore from './store';\nimport { broadcast } from \"../utils\";\n\nexport const router = new Router();\n\nrouter.get('/movies', async (ctx) => {\n    const response = ctx.response;\n    const userId = ctx.state.user._id;\n    response.body = await itemStore.find({ userId });\n    response.status = 200; // ok\n});\n\nrouter.get('/movie/:id', async (ctx) => {\n    const userId = ctx.state.user._id;\n    const item = await itemStore.findOne({ _id: ctx.params.id });\n    const response = ctx.response;\n    if (item) {\n        if (item.userId === userId) {\n            response.body = item;\n            response.status = 200; // ok\n        } else {\n            response.status = 403; // forbidden\n        }\n    } else {\n        response.status = 404; // not found\n    }\n});\n\nconst createItem = async (ctx, item, response) => {\n    console.log(\"SE CREEAZA UN ITEM\");\n    try {\n        const userId = ctx.state.user._id;\n        item.userId = userId;\n        response.body = await itemStore.insert(item);\n        response.status = 201; // created\n        broadcast(userId, { type: 'created', payload: response.body });\n    } catch (err) {\n        response.body = { message: err.message };\n        response.status = 400; // bad request\n    }\n};\n\nrouter.post('/movie', async ctx => await createItem(ctx, ctx.request.body, ctx.response));\n\nrouter.put('/movie/:id', async (ctx) => {\n    console.log(\"SE EDITEAZA UN ITEM\");\n    const item = ctx.request.body;\n    const id = ctx.params.id;\n    const itemId = item._id;\n    const response = ctx.response;\n    if (itemId && itemId !== id) {\n        response.body = { message: 'Param id and body _id should be the same' };\n        response.status = 400; // bad request\n        return;\n    }\n    const userId = ctx.state.user._id;\n    item.userId = userId;\n    const updatedCount = await itemStore.update({ _id: id }, item);\n    if (updatedCount === 1) {\n        response.body = item;\n        response.status = 200; // ok\n        broadcast(userId, { type: 'updated', payload: item });\n    } else {\n        response.body = { message: 'Resource no longer exists' };\n        response.status = 405; // method not allowed\n    }\n});\n\nrouter.del('/movie/:id', async (ctx) => {\n    const userId = ctx.state.user._id;\n    const item = await itemStore.findOne({ _id: ctx.params.id });\n    if (item && userId !== item.userId) {\n        ctx.response.status = 403; // forbidden\n    } else {\n        await itemStore.remove({ _id: ctx.params.id });\n        ctx.response.status = 204; // no content\n    }\n});\n","import dataStore from 'nedb-promise';\n\nexport class ItemStore {\n    constructor({filename, autoload}) {\n        this.store = dataStore({filename, autoload});\n    }\n\n    async find(props) {\n        return this.store.find(props);\n    }\n\n    async findOne(props) {\n        return this.store.findOne(props);\n    }\n\n    async insert(item) {\n        return this.store.insert(item);\n    };\n\n    async update(props, item) {\n        return this.store.update(props, item);\n    }\n\n    async remove(props) {\n        return this.store.remove(props);\n    }\n}\n\nexport default new ItemStore({filename: './db/items.json', autoload: true});","export const jwtConfig = {secret: 'my-secret'};\n","export * from './constants';\nexport * from './middlewares';\nexport * from './wss';\n","export const exceptionHandler = async (ctx, next) => {\n    try {\n        return await next();\n    } catch (err) {\n        ctx.body = {message: err.message || 'Unexpected error.'};\n        ctx.status = err.status || 500;\n    }\n};\n\nexport const timingLogger = async (ctx, next) => {\n    const start = Date.now();\n    await next();\n    console.log(`${ctx.method} ${ctx.url} => ${ctx.response.status}, ${Date.now() - start}ms`);\n};\n","import WebSocket from \"ws\";\nimport jwt from \"jsonwebtoken\";\nimport {jwtConfig} from \"./constants\";\n\nlet wss;\n\nexport const initWss = value => {\n    wss = value;\n    wss.on('connection', ws => {\n        ws.on('message', message => {\n            const {type, payload: {token}} = JSON.parse(message);\n            if (type !== 'authorization') {\n                ws.close();\n                return;\n            }\n            try {\n                ws.user = jwt.verify(token, jwtConfig.secret);\n            } catch (err) {\n                ws.close();\n            }\n        })\n    });\n};\n\nexport const broadcast = (userId, data) => {\n    if (!wss) {\n        return;\n    }\n    wss.clients.forEach(client => {\n        if (client.readyState === WebSocket.OPEN && userId === client.user._id) {\n            console.log(`broadcast sent to ${client.user.username}`);\n            client.send(JSON.stringify(data));\n        }\n    });\n};\n","module.exports = require(\"@koa/cors\");","module.exports = require(\"http\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");","module.exports = require(\"ws\");"],"sourceRoot":""}