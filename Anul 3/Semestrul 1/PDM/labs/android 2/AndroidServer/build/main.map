{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/auth/index.js","webpack:///./src/auth/router.js","webpack:///./src/auth/store.js","webpack:///./src/index.js","webpack:///./src/movie/index.js","webpack:///./src/movie/router.js","webpack:///./src/movie/store.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///./src/utils/wss.js","webpack:///external \"@koa/cors\"","webpack:///external \"http\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\"","webpack:///external \"ws\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","userStore","insert","body","token","status","err","issue","error","message","post","ctx","request","credentials","findOne","password","console","log","UserStore","constructor","filename","autoload","store","dataStore","props","app","Koa","server","http","createServer","callback","wss","WebSocket","Server","initWss","use","cors","timingLogger","exceptionHandler","bodyParser","prefix","publicApiRouter","authRouter","routes","allowedMethods","protectedApiRouter","movieItemRouter","listen","get","userId","state","movieStore","find","movie","params","id","movieItem","createMovie","undefined","insertedMovie","_objectSpread","broadcast","type","payload","put","movies","currentMovies","existingMovie","m","update","movieItemId","updatedCount","del","remove","movieItemStore","param","name","length","Error","next","start","Date","now","method","url","value","on","ws","JSON","parse","close","verify","data","clients","forEach","client","readyState","OPEN","send","stringify"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './router';","import Router from \"koa-router\";\r\nimport userStore from \"./store\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { jwtConfig } from \"../utils\";\r\n\r\nexport const router = new Router();\r\n\r\nconst createToken = (user) => {\r\n  return jwt.sign(\r\n    { username: user.username, _id: user._id },\r\n    jwtConfig.secret,\r\n    { expiresIn: 60 * 60 * 60 }\r\n  );\r\n};\r\n\r\nconst createUser = async (user, response) => {\r\n  try {\r\n    await userStore.insert(user);\r\n    response.body = { token: createToken(user) };\r\n    response.status = 201; // created\r\n  } catch (err) {\r\n    response.body = { issue: [{ error: err.message }] };\r\n    response.status = 400; // bad request\r\n  }\r\n};\r\n\r\nrouter.post(\r\n  \"/signup\",\r\n  async (ctx) => await createUser(ctx.request.body, ctx.response)\r\n);\r\n\r\nrouter.post(\"/login\", async (ctx) => {\r\n  const credentials = ctx.request.body;\r\n  const response = ctx.response;\r\n  const user = await userStore.findOne({ username: credentials.username });\r\n  if (user && credentials.password === user.password) {\r\n    response.body = { token: createToken(user) };\r\n    console.log(response.body);\r\n    response.status = 201; // created\r\n  } else {\r\n    response.body = { issue: [{ error: \"Invalid credentials\" }] };\r\n    response.status = 400; // bad request\r\n  }\r\n});\r\n","import dataStore from 'nedb-promise';\r\n\r\nexport class UserStore {\r\n  constructor({ filename, autoload }) {\r\n    this.store = dataStore({ filename, autoload });\r\n  }\r\n  \r\n  async findOne(props) {\r\n    return this.store.findOne(props);\r\n  }\r\n  \r\n  async insert(user) {\r\n    //\r\n    return this.store.insert(user);\r\n  };\r\n}\r\n\r\nexport default new UserStore({ filename: './db/users.json', autoload: true });","import Koa from \"koa\";\r\nimport WebSocket from \"ws\";\r\nimport http from \"http\";\r\nimport Router from \"koa-router\";\r\nimport bodyParser from \"koa-bodyparser\";\r\nimport {\r\n  timingLogger,\r\n  exceptionHandler,\r\n  jwtConfig,\r\n  initWss,\r\n  verifyClient,\r\n} from \"./utils\";\r\nimport { router as movieItemRouter } from \"./movie\";\r\nimport { router as authRouter } from \"./auth\";\r\nimport jwt from \"koa-jwt\";\r\nimport cors from \"@koa/cors\";\r\n\r\nconst app = new Koa();\r\nconst server = http.createServer(app.callback());\r\nconst wss = new WebSocket.Server({ server });\r\ninitWss(wss);\r\n\r\napp.use(cors());\r\napp.use(timingLogger);\r\napp.use(exceptionHandler);\r\napp.use(bodyParser());\r\n\r\nconst prefix = \"/api\";\r\n\r\n// public\r\nconst publicApiRouter = new Router({ prefix });\r\npublicApiRouter.use(\"/auth\", authRouter.routes());\r\napp.use(publicApiRouter.routes()).use(publicApiRouter.allowedMethods());\r\n\r\nconsole.log(\"JWT TRY\")\r\napp.use(jwt(jwtConfig));\r\nconsole.log(\"JWT SUCCESS\")\r\n\r\n// protected\r\nconst protectedApiRouter = new Router({ prefix });\r\nprotectedApiRouter.use(\"/movie\", movieItemRouter.routes());\r\napp.use(protectedApiRouter.routes()).use(protectedApiRouter.allowedMethods());\r\n\r\nserver.listen(3000);\r\nconsole.log(\"started on port 3000\");\r\n","export * from './router';","import Router from \"koa-router\";\r\nimport { movieStore } from \"./store\";\r\nimport { broadcast } from \"../utils\";\r\n\r\nexport const router = new Router();\r\n\r\nrouter.get(\"/\", async (ctx) => {\r\n  console.log(\"hereeee\")\r\n  const response = ctx.response;\r\n  const userId = ctx.state.user._id;\r\n  response.body = await movieStore.find({ userId });\r\n  response.status = 200; // ok\r\n});\r\n\r\nrouter.get(\"/:id\", async (ctx) => {\r\n  const userId = ctx.state.user._id;\r\n  const movie = await movieStore.findOne({ _id: ctx.params.id });\r\n  const response = ctx.response;\r\n  if (movie) {\r\n    if (movie.userId === userId) {\r\n      response.body = movieItem;\r\n      response.status = 200; // ok\r\n    } else {\r\n      response.status = 403; // forbidden\r\n    }\r\n  } else {\r\n    response.status = 404; // not found\r\n  }\r\n});\r\n\r\n\r\n\r\nconst createMovie = async (ctx, movie, response) => {\r\n  try{\r\n      const userId=ctx.state.user._id;\r\n      movie.userId=userId;\r\n      movie._id=undefined\r\n      const insertedMovie = await movieStore.insert(movie);\r\n      response.body = { ...insertedMovie, _id: insertedMovie._id };\r\n      console.log('response.body',response.body)\r\n      response.status = 201; // CREATED\r\n      broadcast(userId,{type: 'created', payload: insertedMovie});\r\n  }catch(err){\r\n      response.body={message:err.message};\r\n      response.status=400;\r\n  }\r\n};\r\n\r\nrouter.put('/sync', async (ctx) => {\r\n  try{\r\n      const userId = ctx.state.user._id;\r\n      console.log(\"userId: \"+userId)\r\n      const movies = ctx.request.body;\r\n      console.log(\"movies=\"+movies)\r\n      const response = ctx.response;\r\n      const currentMovies = await movieStore.find({ userId });\r\n      for (var movie of movies) {\r\n        movie.userId=userId\r\n          if (!movie._id)\r\n          {\r\n            await createMovie(ctx,movie,ctx.response)\r\n          }\r\n          else{\r\n              const existingMovie = currentMovies.find(m => m._id === movie._id);\r\n              if (existingMovie) {\r\n                  await movieStore.update({ _id: movie._id }, movie);\r\n              }\r\n          }\r\n      }\r\n\r\n      response.body = await movieStore.find({ userId });\r\n      response.status = 200;\r\n      //broadcast(userId, { type: 'sync', payload: response.body });\r\n  }\r\n  catch (err) {\r\n      console.log(err)\r\n      ctx.response.body = { message: err.message };\r\n      ctx.response.status = 400;\r\n  }\r\n\r\n});\r\nrouter.post('/', async (ctx) => {\r\n  console.log('body', ctx.request.body);\r\n  await createMovie(ctx, ctx.request.body, ctx.response);\r\n});\r\n\r\nrouter.put(\"/:id\", async (ctx) => {\r\n  const movieItem = ctx.request.body;\r\n  const id = ctx.params.id;\r\n  const movieItemId = movieItem._id;\r\n  const response = ctx.response;\r\n  if (movieItemId && movieItemId !== id) {\r\n    response.body = { message: \"Param id and body _id should be the same\" };\r\n    response.status = 400; // bad request\r\n    return;\r\n  }\r\n  if (!movieItemId) {\r\n    await createMovie(ctx, movieItem, response);\r\n  } else {\r\n    const userId = ctx.state.user._id;\r\n    movieItem.userId = userId;\r\n    const updatedCount = await movieStore.update(\r\n      { _id: id },\r\n      movieItem\r\n    );\r\n    if (updatedCount === 1) {\r\n      response.body = movieItem;\r\n      response.status = 200; // ok\r\n      broadcast(userId, { type: \"updated\", payload: movieItem });\r\n    } else {\r\n      response.body = { message: \"Resource no longer exists\" };\r\n      response.status = 405; // method not allowed\r\n    }\r\n  }\r\n});\r\n\r\nrouter.del(\"/:id\", async (ctx) => {\r\n  const userId = ctx.state.user._id;\r\n  const movieItem = await movieStore.findOne({ _id: ctx.params.id });\r\n  if (movieItem && userId !== movieItem.userId) {\r\n    ctx.response.status = 403; // forbidden\r\n  } else {\r\n    await movieStore.remove({ _id: ctx.params.id });\r\n    ctx.response.status = 204; // no content\r\n  }\r\n});\r\n\r\n\r\n","import dataStore from \"nedb-promise\";\r\n\r\nclass movieItemStore {\r\n  constructor({filename,autoload}) {\r\n    this.store=dataStore({filename,autoload});\r\n}\r\n\r\nasync find(param){\r\n    return this.store.find(param);\r\n}\r\nasync findOne(param){\r\n    return this.store.findOne(param);\r\n}\r\nasync insert(movie){\r\n\r\n    if (movie.name.length < 1)\r\n        throw new Error('Name must be at least 1 character');\r\n    return this.store.insert(movie);\r\n}\r\nasync update(param,movie){\r\n    return this.store.update(param,movie);\r\n    //return 1;\r\n}\r\nasync remove(param){\r\n    return this.store.remove(param);\r\n}\r\n}\r\n\r\nexport const movieStore=new movieItemStore({filename:'./db/movies.json',autoload:true});\r\n","export const jwtConfig = {\r\n  secret:\r\n    \"my-secret\",\r\n};\r\n","export * from './constants';\r\nexport * from './middlewares';\r\nexport * from './wss';\r\n","export const exceptionHandler = async (ctx, next) => {\r\n  try {\r\n    return await next();\r\n  } catch (err) {\r\n    ctx.body = { message: err.message || 'Unexpected error.' };\r\n    ctx.status = err.status || 500;\r\n  }\r\n};\r\n\r\nexport const timingLogger = async (ctx, next) => {\r\n  const start = Date.now();\r\n  await next();\r\n  console.log(`${ctx.method} ${ctx.url} => ${ctx.response.status}, ${Date.now() - start}ms`);\r\n};\r\n","import WebSocket from \"ws\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { jwtConfig } from \"./constants\";\r\n\r\nlet wss;\r\n\r\nexport const initWss = value => {\r\n  wss = value;\r\n  wss.on('connection', ws => {\r\n    ws.on('message', message => {\r\n      const { type, payload: { token } } = JSON.parse(message);\r\n      if (type !== 'authorization') {\r\n        ws.close();\r\n        return;\r\n      }\r\n      try {\r\n        ws.user = jwt.verify(token, jwtConfig.secret);\r\n      } catch (err) {\r\n        ws.close();\r\n      }\r\n    })\r\n  });\r\n};\r\n\r\nexport const broadcast = (userId, data) => {\r\n  if (!wss) {\r\n    return;\r\n  }\r\n  wss.clients.forEach(client => {\r\n    if (client.readyState === WebSocket.OPEN && userId === client.user._id) {\r\n      console.log(`broadcast sent to ${client.user.username}`);\r\n      client.send(JSON.stringify(data));\r\n    }\r\n  });\r\n};\r\n","module.exports = require(\"@koa/cors\");","module.exports = require(\"http\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");","module.exports = require(\"ws\");"],"sourceRoot":""}